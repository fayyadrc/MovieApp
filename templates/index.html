<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Search</title>
    <link rel="stylesheet" href="styles/indexCSS.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
    <nav class="navbar bg-body-tertiary">
        <div class="container-fluid">
            <a class="navbar-brand">Movie App</a>
            <form action="/search" method="POST" class="d-flex" role="search">
                <input type="text" class="form-control me-2" name="query" placeholder="Enter movie name" required
                    aria-label="Search">
                <button class="btn btn-outline-success" type="submit">Search</button>
            </form>
        </div>
    </nav>

    <div class="container">
        <h1 class="my-4">Trending Movies</h1>

        <div class="row">
            {% for movie in movies %}
            <div class="col-md-3">
                <div class="card mb-4" data-bs-toggle="modal" data-bs-target="#movieModal"
                    onclick="showMovieDetails({{ loop.index0 }})">
                    {% if movie.Poster %}
                    <img src="{{ movie.Poster }}" class="card-img-top" alt="Poster for {{ movie.Title }}">
                    {% else %}
                    <img src="https://via.placeholder.com/500x750?text=No+Image" class="card-img-top"
                        alt="No image available">
                    {% endif %}
                    <div class="card-body">
                        <h5 class="card-title">{{ movie.Title }}</h5>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="movieModal" tabindex="-1" aria-labelledby="movieModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="movieModalLabel">Movie Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body d-flex">
                    <img id="modalPoster" src="" alt="Movie Poster" class="img-fluid me-4" style="max-width: 200px;">
                    <div>
                        <h5 id="modalTitle"></h5>
                        <p><strong>Overview:</strong> <span id="modalOverview"></span></p>
                        <p><strong>Release Date:</strong> <span id="modalReleaseDate"></span></p>
                        <p><strong>Cast:</strong> <span id="modalCast"></span></p> 
                        <p><strong>Producers:</strong> <span id="modalProducers"></span></p>
                        <p><strong>Genres:</strong> <span id="modalGenres"></span></p>
                        <p><strong>Vote Average:</strong> <span id="modalVoteAverage"></span></p>
                    </div>
                </div>

            </div>
        </div>
    </div>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>


    <script>

        const movieData = {{ movies | safe }}
        console.log(movieData)

        //display movies in modal popups
        function showMovieDetails(index) {
            const movie = movieData[index];
            if (movie) {
                document.getElementById('modalPoster').src = movie.Poster;
                document.getElementById('modalTitle').innerText = movie.Title;
                document.getElementById('modalOverview').innerText = movie.Overview;
                document.getElementById('modalCast').innerText = movie.Cast.join(', ');
                document.getElementById('modalReleaseDate').innerText = movie['Release Date'];
                document.getElementById('modalVoteAverage').innerText = movie['Vote Average'];
                document.getElementById('modalProducers').innerText = movie.Producers.join(', ');
                document.getElementById('modalGenres').innerText = movie.Genres.join(', ');
                

                // Show the modal
                const modal = new bootstrap.Modal(document.getElementById('movieModal'));
                modal.show();
            } else {
                console.error("Movie data not found for index: " + index);
            }
        }
        
var modal = document.getElementById('movieModal');

modal.addEventListener('hidden.bs.modal', function () {
    document.body.style.overflow = 'auto'; 
    document.querySelector('.modal-backdrop')?.remove(); 
});

    </script>

</body>

</html>